var BeMarking=Class.extend({init:function(){this.initVdt();this.bindLis();this.choosePrg(0)},url:{},selfObj:{},initVdt:function(){this.vdtObj={};this.vdtObj.mktAccntFmVdt=new validate({formID:"mktAccntFm",onfocusout:true,rules:{department:{required:true,maxlength:50},realName:{required:true,maxlength:50},idCardNo:{required:true,isIdCardNo:true}},messages:{department:{maxlength:"最大长度为50"},realName:{maxlength:"最大长度为50"}}})},bindLis:function(){$("#mktAccntNxt").click(this,this.applyMarketAccount)},choosePrg:function(b,d){var a;if(d){a=$("#"+d).find(".mp-updAccount-prg-itm")}else{a=$(".mp-updAccount-prg-itm")}a.removeClass("mp-updAccount-prg-itm-active");$(a[b-1]).addClass("mp-updAccount-prg-itm-active");$(".js-prg").hide();$(".js-prg-"+b).show();for(var c=0;c<=b;c++){$(".js-prg-"+c+"more").show()}},openMktAccnt:function(a){this.selfObj.MktAccntDg=layer.open({type:1,title:false,fix:false,closeBtn:0,skin:"beMkt",resize:false,area:["940px","490px"],content:$("#mp-updAccount-prg-main"),success:a})},applyMarketAccount:function(a){var b=a.data;if(b.vdtObj.mktAccntFmVdt.validateForm()){Common.sendFormData(mpUrlsObj.brMkt.applyMarketAccount,function(c){if(c.isSuccess){b.choosePrg(3)}else{alert(c.resultMsg)}},$("#mktAccntFm").serialize())}},DOMId:{loginName:"loginName",updAccountBtn:"updAccountBtn"},queryUser:function(a){var b=this;Common.sendFormData(mpUrlsObj.brMkt.queryUser,function(e){if(e.isSuccess){var c=e.data.status;if(c==1||c==2){var d=function(){if(c==1){var h=$("#"+b.DOMId.loginName);h.html(e.data.loginName);var j=e.type;var i=$("#"+b.DOMId.updAccountBtn);var k=function(l){i.html("完善账户信息成为营销账户");switch(l){case 1:window.open(mpUrlsObj.brMkt.bindMobile);break;case 2:window.open(mpUrlsObj.brMkt.bindEmail);break;case 3:b.choosePrg(2)}i[0].onclick=function(){b.queryUser(true)}};if(!e.data.mobile){i.html("去绑定手机号码");layer.tips("手机号没有绑定","#"+b.DOMId.updAccountBtn,{tips:[1,"#de143a"],time:3000});i[0].onclick=function(){k(1)}}else{if(!e.data.email){i.html("去绑定邮箱");layer.tips("邮箱没有绑定","#"+b.DOMId.updAccountBtn,{tips:[1,"#de143a"],time:3000});i[0].onclick=function(){k(2)}}else{i.html("完善账户信息成为营销账户");i[0].onclick=function(){k(3)}}}}else{b.choosePrg(3)}};if(!a){b.openMktAccnt(d)}else{d()}}}else{var f=e.data.loginUrl;var g=window.location.href;location.href=f+"?returnUrl="+g}})}});var beMarking=new BeMarking();beMarking.queryUser();