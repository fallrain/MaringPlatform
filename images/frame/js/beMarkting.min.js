var BeMarking=Class.extend({init:function(){this.initVdt();this.bindLis()},url:{},selfObj:{},initVdt:function(){this.vdtObj={};this.vdtObj.mktAccntFmVdt=new validate({formID:"mktAccntFm",onfocusout:true,rules:{department:{required:true},realName:{required:true},idCardNo:{required:true,isIdCardNo:true}},messages:{}})},bindLis:function(){$("#mktAccntNxt").click(this,this.applyMarketAccount)},choosePrg:function(b,d){var a;if(d){a=$("#"+d).find(".mp-updAccount-prg-itm")}else{a=$(".mp-updAccount-prg-itm")}a.removeClass("mp-updAccount-prg-itm-active");$(a[b-1]).addClass("mp-updAccount-prg-itm-active");$(".js-prg").hide();$(".js-prg-"+b).show();for(var c=0;c<=b;c++){$(".js-prg-"+c+"more").show()}},openMktAccnt:function(a){this.selfObj.MktAccntDg=layer.open({type:1,title:false,fix:false,closeBtn:0,skin:"beMkt",resize:false,area:["940px","490px"],content:$("#mp-updAccount-prg-main"),success:a})},applyMarketAccount:function(a){var b=a.data;if(b.vdtObj.mktAccntFmVdt.validateForm()){Common.sendFormData(mpUrlsObj.brMkt.applyMarketAccount,function(c){if(c.isSuccess){b.choosePrg(3)}else{alert(c.resultMsg)}},$("#mktAccntFm").serialize())}},DOMId:{loginName:"loginName",updAccountBtn:"updAccountBtn"},queryUser:function(a){var b=this;Common.sendFormData(mpUrlsObj.brMkt.queryUser,function(d){if(d.isSuccess){var c=d.data.status;if(c==1||c==2){if(!a){b.openMktAccnt(function(){if(c==1){var g=$("#"+b.DOMId.loginName);g.html(d.data.loginName);var i=d.type;var h=$("#"+b.DOMId.updAccountBtn);var j=function(k){h.html("完善账户信息成为营销账户");switch(k){case 1:window.open(mpUrlsObj.brMkt.bindMobile);break;case 2:window.open(mpUrlsObj.brMkt.bindEmail);break;case 3:b.choosePrg(2)}h[0].onclick=function(){b.queryUser(true)}};if(!d.data.mobile){h.html("去绑定手机号码");layer.tips("手机号没有绑定","#"+b.DOMId.updAccountBtn,{tips:[1,"#de143a"],time:3000});h[0].onclick=function(){j(1)}}else{if(!d.data.email){h.html("去绑定邮箱");layer.tips("邮箱没有绑定","#"+b.DOMId.updAccountBtn,{tips:[1,"#de143a"],time:3000});h[0].onclick=function(){j(2)}}else{h.html("完善账户信息成为营销账户");h[0].onclick=function(){j(3)}}}}else{b.choosePrg(3)}})}}}else{var e=d.data.loginUrl;var f=window.location.href;location.href=e+"?returnUrl="+f}})}});var beMarking=new BeMarking();beMarking.choosePrg(0);beMarking.queryUser();