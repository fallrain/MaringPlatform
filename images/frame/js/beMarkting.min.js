var BeMarking=Class.extend({init:function(){this.initVdt();this.bindLis()},url:{},initVdt:function(){this.vdtObj={};this.vdtObj.mktAccntFmVdt=new validate({formID:"mktAccntFm",onfocusout:true,rules:{department:{required:true},realName:{required:true},idCardNo:{required:true}},messages:{}})},bindLis:function(){$("#mktAccntNxt").click(this,this.applyMarketAccount)},choosePrg:function(b,d){var a;if(d){a=$("#"+d).find(".mp-updAccount-prg-itm")}else{a=$(".mp-updAccount-prg-itm")}a.removeClass("mp-updAccount-prg-itm-active");$(a[b-1]).addClass("mp-updAccount-prg-itm-active");$(".js-prg").hide();$(".js-prg-"+b).show();for(var c=0;c<=b;c++){$(".js-prg-"+c+"more").show()}},openMktAccnt:function(){layer.open({type:1,title:false,fix:false,closeBtn:0,skin:"beMkt",resize:false,area:["940px","490px"],content:$("#mp-updAccount-prg-main"),end:function(){}})},applyMarketAccount:function(a){var b=a.data;if(b.vdtObj.mktAccntFmVdt.validateForm()){Common.sendFormData(mpUrlsObj.brMkt.applyMarketAccount,function(c){if(c.isSuccess){}else{alert(c.resultMsg)}},$("#mktAccntFm").serialize())}},DOMId:{loginName:"loginName",updAccountBtn:"updAccountBtn"},queryUser:function(a){var b=this;if(!a){b.openMktAccnt()}Common.sendFormData(mpUrlsObj.brMkt.queryUser,function(f){if(f.isSuccess){var c=$("#"+b.DOMId.loginName);c.html(f.data.loginName);var e=f.type;var d=$("#"+b.DOMId.updAccountBtn);var h=function(j){d.html("完善账户信息成为营销账户");switch(j){case 1:window.open(mpUrlsObj.brMkt.bindMobile);break;case 2:window.open(mpUrlsObj.brMkt.bindEmail);break;case 3:beMarking.choosePrg(2)}d[0].onclick=function(){b.queryUser(true)}};if(!f.mobile){d.html("去绑定手机号码");layer.tips("手机号没有绑定","#"+b.DOMId.updAccountBtn,{tips:[1,"#de143a"],time:3000});d[0].onclick=function(){h(1)}}else{if(!f.email){d.html("去绑定邮箱");layer.tips("邮箱没有绑定","#"+b.DOMId.updAccountBtn,{tips:[1,"#de143a"],time:3000});d[0].onclick=function(){h(2)}}else{d[0].onclick=function(){h(3)}}}}else{var g=f.data.loginUrl;var i=window.location.href;location.href=g+"?returnUrl="+i}})}});var beMarking=new BeMarking();beMarking.choosePrg(0);beMarking.queryUser();